import{H as M,B as H,r as d,c as E,d as P,u as R,o as T,w as V,b as C,h as r,e as J,G as D,F as S,j as L,i as O,m as U,n as I,I as Y,J as k,z as j,v as G,x as K,_ as W}from"./index-DddgXWB4.js";const X="/assets/%E8%A7%92%E8%89%B2%E4%BB%8B%E7%BB%8Dtext-DTLS6hsH.png";class q{httpService;constructor(){this.httpService=M.getInstance()}async getAllChars(){try{console.log("尝试获取所有角色信息");try{console.log("尝试API路径: /chars/");const e=await this.httpService.get("/chars");return console.log(e),e}catch{try{console.log("尝试API路径: /api/characters/");const l=await this.httpService.get("/characters/");return console.log("备用路径请求成功，返回角色列表"),l}catch(l){throw l}}}catch(e){throw console.error("获取角色列表时发生错误:",e),e}}async getCharById(e){try{console.log(`尝试获取角色ID: ${e}的信息`);const l=`/chars/${e}`;console.log(`尝试API路径: ${l}`);const u=await this.httpService.get(l);return console.log(`成功获取角色ID: ${e}的信息`),u}catch(l){throw console.error(`获取角色ID: ${e}信息时发生错误:`,l),l}}}const A=new q,F="char_cache_data",$=300*1e3,Q=()=>{try{const s=localStorage.getItem(F);if(s){const e=JSON.parse(s);if(Date.now()-e.lastFetched<$)return e}}catch(s){console.error("Failed to load characters from cache:",s)}return null},Z=s=>{try{localStorage.setItem(F,JSON.stringify(s))}catch(e){console.error("Failed to save characters to cache:",e)}},ee=H("Chars",()=>{const s=d([]),e=d(!1),l=d(null),u=d(0),h=E(()=>u.value>0&&Date.now()-u.value<$),_=Q();_&&(s.value=_.charList,u.value=_.lastFetched);const y=async()=>{if(!h.value){e.value=!0,l.value=null;try{console.log("调用charService.getAllChars()获取角色数据...");const c=await A.getAllChars();console.log("获取角色数据成功:",c),s.value=c,u.value=Date.now(),Z({charList:s.value,lastFetched:u.value}),console.log("成功获取角色数据，数量：",s.value.length)}catch(c){l.value=c instanceof Error?c.message:"获取角色失败",console.error("Failed to fetch all characters:",c)}finally{e.value=!1}}},g=async c=>{e.value=!0,l.value=null;try{const v=await A.getCharById(c);if(v){const p=s.value.findIndex(B=>B.id===c);return p===-1?s.value=[v,...s.value]:s.value[p]=v,v}return null}catch(v){return l.value=v instanceof Error?v.message:"获取角色详情失败",console.error(`Failed to fetch character with id ${c}:`,v),null}finally{e.value=!1}},n=()=>{s.value=[],e.value=!1,l.value=null},m=E(()=>c=>s.value.find(v=>v.id===c)||null);return{charList:s,loading:e,error:l,lastFetched:u,isCacheValid:h,getCharById:m,fetchAllChar:y,fetchCharById:g,resetState:n}}),ae={class:"sliderWrap-container"},te={class:"fixed-center-container"},re=["onClick"],le=["src"],se=["src"],ce={class:"char-indicator-container"},ne=["onClick"],oe=["src"],ie={class:"char-introduce"},ue={class:"char-name"},he=["src"],ve=P({__name:"index",setup(s){const e=d(0),l=d(0),u=d(0),h=ee(),_=R(),y=d([]),g=d([]),n=d(0),m=d(0),c=d([]);T(async()=>{try{if(await h.fetchAllChar(),y.value=[...new Set(h.charList.map(a=>a.campLogo))],g.value=[...new Set(h.charList.map(a=>a.camp))],n.value=y.value.length*2,m.value=360/n.value,h.charList.length>0){const a=g.value[u.value];c.value=h.charList.filter(t=>t.camp===a),await v()}}catch(a){console.error("获取角色数据失败:",a),_.markComponentLoaded("char-introduce")}});const v=async()=>{if(h.charList.length===0)return;const a=h.charList.flatMap(t=>[t.charBg,t.charImg,t.indicatorImg]);await x(a),_.markComponentLoaded("char-introduce")},p=E(()=>{const a=l.value/m.value;let t=Math.round((n.value-a)%n.value);if(t<0&&(t+=n.value),u.value=t%g.value.length,c.value=[],g.value.length>0){let f=g.value[u.value];e.value=0,c.value=h.charList.filter(o=>o.camp===f)}return t}),B=a=>{const t=p.value;return[t,(t+1)%n.value,(t+2)%n.value,(t-1+n.value)%n.value,(t-2+n.value)%n.value].includes(a)},b=a=>{a===(p.value+1)%n.value?l.value-=m.value:(p.value+2)%n.value===a?l.value-=2*m.value:(p.value-1+n.value)%n.value===a?l.value+=m.value:(p.value-2+n.value)%n.value===a&&(l.value+=2*m.value)},z=a=>{e.value=a},x=a=>new Promise(t=>{if(a.length===0){t();return}let f=0;a.forEach(o=>{const i=new Image;i.src=o;const w=()=>{f++,f===a.length&&t()};i.onload=w,i.onerror=()=>{i.src="@/assets/default-img.png",w()}})});V(u,()=>{N()});const N=()=>{if(g.value.length===0||h.charList.length===0)return;const a=g.value[u.value],f=h.charList.filter(o=>o.camp===a).flatMap(o=>[o.charBg,o.charImg,o.indicatorImg]);x(f)};return(a,t)=>{const f=U("el-card");return I(),C("div",null,[r("div",ae,[r("div",te,[r("div",{class:"rotation-container",style:D({transform:`rotate(${l.value}deg)`})},[(I(),C(S,null,L(22,(o,i)=>Y([i,p.value],()=>G((I(),C("div",{class:"tab-panel",style:D({transform:`rotate(${-90+i*m.value}deg) translateY(-30rem)`,opacity:1,pointerEvents:"auto",zIndex:1})},[r("div",{class:"panel-content",onClick:w=>b(i)},[r("img",{src:y.value[i%g.value.length],class:"campImg",loading:"lazy"},null,8,le)],8,re)],4)),[[K,B(i)]]),{key:i},0)),64))],4)])]),(I(!0),C(S,null,L(c.value,(o,i)=>(I(),C("div",{class:k(["char-bg-container",{active:i==e.value?1:0}]),key:o.id},[r("img",{src:o.charBg,alt:"",class:"char-bg-img",loading:"lazy"},null,8,se)],2))),128)),t[3]||(t[3]=r("div",{class:"char-name-container"},[r("img",{src:X,class:"char-name-img"})],-1)),r("div",ce,[(I(!0),C(S,null,L(c.value,(o,i)=>(I(),C("div",{class:"char-indicator",onClick:w=>z(i),key:o.id},[r("img",{src:o.indicatorImg,class:"indicator-img",loading:"lazy"},null,8,oe)],8,ne))),128))]),J(f,null,{default:O(()=>[r("div",ie,[r("span",ue,j(c.value[e.value]?.name||""),1),t[1]||(t[1]=r("span",{class:"char-text-title"},"大战前重新整装待发。嗯，是很经典的电影桥段",-1)),t[2]||(t[2]=r("div",{class:"char-text"},[r("span",null,[r("p",null,"「怎么说呢…现在看到安比换回这身行头，思绪好乱。记忆的潮水像装满丁尼的扑满被砸开一样，用安比 的话说，好像叫…蒙太奇？」 "),r("p",null,"——妮可·德玛拉"),r("p",null,"「不期待拥戴和赞美，刀刃上全然没有对血的渴望，哪怕是『恨』也无妨吗？」"),r("p",null,"——「扳机」"),r("p",null,"「糟糕！又认错了。六分街也不算大，她和那位爱吃辣的女孩从来没遇到过吗？！」"),r("p",null,"——乔普师傅"),r("p",null,"「我的绝望和渴望不过是一场因你降下视线而生的诅咒，你…会斩断的吧。」"),r("p",null,"——是生命？是躯壳？还是永夜里的一声叹息？")])],-1))]),(I(!0),C(S,null,L(c.value,(o,i)=>(I(),C("div",{class:k(["char-img-container",{active:i==e.value?1:0}]),key:o.id},[r("img",{src:o.charImg,alt:"",class:"char-name-img",loading:"lazy"},null,8,he)],2))),128))]),_:1})])}}}),ge=W(ve,[["__scopeId","data-v-999edfe0"]]);export{ge as default};
